<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSS Diagnostics Manual Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #007bff;
            padding-bottom: 10px;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section h2 {
            color: #007bff;
            margin-top: 0;
        }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 10px 0;
        }
        .instruction {
            background: #e7f3ff;
            border-left: 4px solid #007bff;
            padding: 10px 15px;
            margin: 10px 0;
        }
        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 10px 15px;
            margin: 10px 0;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        #results {
            white-space: pre-wrap;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-top: 10px;
            display: none;
        }
        #results.show {
            display: block;
        }
        .success {
            color: green;
            font-weight: bold;
        }
        .error {
            color: red;
            font-weight: bold;
        }
        .info {
            color: #007bff;
        }
    </style>
</head>
<body>
    <h1>CSS Diagnostics Manual Test for Fab.OS Sidebar</h1>

    <div class="warning">
        <strong>Prerequisites:</strong> Make sure the application is running at http://localhost:8080 and you are logged in as admin@steelestimation.com
    </div>

    <div class="test-section">
        <h2>Step 1: Manual Browser Checks</h2>
        <div class="instruction">
            <p><strong>Please perform these checks manually in your browser:</strong></p>
            <ol>
                <li>Open http://localhost:8080 in a new tab</li>
                <li>Login with admin@steelestimation.com / Admin@123</li>
                <li>Open Developer Tools (F12)</li>
                <li>Go to the Network tab and filter by CSS</li>
                <li>Refresh the page (Ctrl+R)</li>
                <li>Look for these files and note their status codes:
                    <ul>
                        <li>site.css - Status: _____</li>
                        <li>sidebar.css - Status: _____ (if present)</li>
                        <li>viewscape.css - Status: _____ (if present)</li>
                    </ul>
                </li>
            </ol>
        </div>
    </div>

    <div class="test-section">
        <h2>Step 2: Run JavaScript Diagnostics</h2>
        <div class="instruction">
            <p>Copy and paste this entire code block into the browser console on the logged-in page:</p>
        </div>
        <div class="code-block">
console.log('=== CSS DIAGNOSTICS STARTING ===\n');

// 1. Check all loaded stylesheets
console.log('1. LOADED STYLESHEETS:');
const stylesheets = document.querySelectorAll('link[rel="stylesheet"]');
stylesheets.forEach(link => {
    const fileName = link.href.split('/').pop();
    console.log(`  - ${fileName}: ${link.href}`);
});

// 2. Check for sidebar-specific CSS file
console.log('\n2. SIDEBAR CSS CHECK:');
const hasSidebarCSS = Array.from(stylesheets).some(link => link.href.includes('sidebar.css'));
console.log(`  sidebar.css loaded: ${hasSidebarCSS ? '✓ YES' : '✗ NO'}`);

// 3. Find sidebar elements
console.log('\n3. SIDEBAR ELEMENTS:');
const selectors = ['.custom-sidebar', '.nav-menu', '.sidebar', 'nav', '[class*="sidebar"]'];
let sidebarElement = null;
for (const selector of selectors) {
    const elem = document.querySelector(selector);
    if (elem) {
        sidebarElement = elem;
        console.log(`  ✓ Found: ${selector}`);
        console.log(`    Classes: ${elem.className}`);
        console.log(`    ID: ${elem.id || 'none'}`);
        break;
    }
}
if (!sidebarElement) {
    console.log('  ✗ No sidebar element found!');
}

// 4. Check computed styles
console.log('\n4. COMPUTED STYLES (if sidebar found):');
if (sidebarElement) {
    const styles = window.getComputedStyle(sidebarElement);
    console.log(`  Background: ${styles.backgroundColor}`);
    console.log(`  Width: ${styles.width}`);
    console.log(`  Position: ${styles.position}`);
    console.log(`  Display: ${styles.display}`);
    console.log(`  Color: ${styles.color}`);
    console.log(`  Border: ${styles.border}`);
}

// 5. Check site.css content
console.log('\n5. CHECKING SITE.CSS CONTENT:');
fetch('/css/site.css')
    .then(response => {
        console.log(`  Fetch status: ${response.status} ${response.statusText}`);
        return response.text();
    })
    .then(text => {
        console.log(`  File size: ${text.length} bytes`);
        console.log(`  Contains 'sidebar': ${text.includes('sidebar') ? '✓ YES' : '✗ NO'}`);
        console.log(`  Contains 'custom-sidebar': ${text.includes('custom-sidebar') ? '✓ YES' : '✗ NO'}`);
        console.log(`  Contains 'nav-menu': ${text.includes('nav-menu') ? '✓ YES' : '✗ NO'}`);
        
        // Extract sidebar-related CSS
        const sidebarRegex = /[^}]*sidebar[^{]*{[^}]*}/gi;
        const matches = text.match(sidebarRegex);
        if (matches) {
            console.log(`\n  Found ${matches.length} sidebar-related CSS rules:`);
            matches.slice(0, 3).forEach(rule => {
                console.log(`    ${rule.substring(0, 100)}...`);
            });
        }
    })
    .catch(err => console.error('  Error fetching site.css:', err));

// 6. Check for inline styles
console.log('\n6. INLINE STYLES:');
const styleTags = document.querySelectorAll('style');
console.log(`  Found ${styleTags.length} <style> tags`);
styleTags.forEach((tag, i) => {
    const hasSidebar = tag.textContent.includes('sidebar');
    if (hasSidebar) {
        console.log(`  Style tag ${i+1} contains sidebar styles`);
    }
});

// 7. Highlight sidebar visually
console.log('\n7. VISUAL HIGHLIGHT:');
if (sidebarElement) {
    sidebarElement.style.outline = '3px solid red';
    sidebarElement.style.outlineOffset = '2px';
    console.log('  ✓ Sidebar highlighted with red outline');
} else {
    console.log('  ✗ No sidebar to highlight');
}

console.log('\n=== DIAGNOSTICS COMPLETE ===');
        </div>
    </div>

    <div class="test-section">
        <h2>Step 3: Check Specific CSS Rules</h2>
        <div class="instruction">
            <p>Run this to check if specific CSS rules are being applied:</p>
        </div>
        <div class="code-block">
// Check if custom-sidebar styles are actually defined
const checkRule = (selector) => {
    for (let sheet of document.styleSheets) {
        try {
            for (let rule of sheet.cssRules) {
                if (rule.selectorText && rule.selectorText.includes(selector)) {
                    console.log(`Found rule for ${selector}:`, rule.cssText);
                    return true;
                }
            }
        } catch (e) {
            // Cross-origin stylesheets will throw an error
        }
    }
    return false;
};

console.log('Checking for CSS rules:');
console.log('.custom-sidebar:', checkRule('.custom-sidebar') ? '✓ Found' : '✗ Not found');
console.log('.nav-menu:', checkRule('.nav-menu') ? '✓ Found' : '✗ Not found');
console.log('.sidebar:', checkRule('.sidebar') ? '✓ Found' : '✗ Not found');
        </div>
    </div>

    <div class="test-section">
        <h2>Step 4: Test CSS File Direct Access</h2>
        <div class="instruction">
            <p>Click these buttons to test direct access to CSS files:</p>
        </div>
        <button onclick="testCSSFile('/css/site.css')">Test site.css</button>
        <button onclick="testCSSFile('/css/sidebar.css')">Test sidebar.css</button>
        <button onclick="testCSSFile('/css/viewscape.css')">Test viewscape.css</button>
        <button onclick="testCSSFile('/wwwroot/css/site.css')">Test wwwroot/css/site.css</button>
        <div id="results"></div>
    </div>

    <div class="test-section">
        <h2>Step 5: Report Your Findings</h2>
        <div class="instruction">
            <p>After running all the tests above, please report:</p>
            <ol>
                <li>Which CSS files are loading (200 status)?</li>
                <li>Which CSS files are NOT loading (404 status)?</li>
                <li>Does site.css contain sidebar styles?</li>
                <li>Is the sidebar element present in the HTML?</li>
                <li>What classes does the sidebar element have?</li>
                <li>Is the sidebar highlighted with a red outline after running the diagnostics?</li>
            </ol>
        </div>
    </div>

    <script>
        function testCSSFile(path) {
            const results = document.getElementById('results');
            results.className = 'show';
            results.textContent = `Testing ${path}...\n`;
            
            // Try with localhost:8080
            const fullUrl = `http://localhost:8080${path}`;
            
            fetch(fullUrl)
                .then(response => {
                    results.textContent += `\nStatus: ${response.status} ${response.statusText}\n`;
                    results.textContent += `URL: ${fullUrl}\n`;
                    results.textContent += `Content-Type: ${response.headers.get('Content-Type')}\n`;
                    
                    if (response.ok) {
                        return response.text();
                    } else {
                        throw new Error(`HTTP ${response.status}`);
                    }
                })
                .then(text => {
                    results.textContent += `\n✓ SUCCESS - File loaded\n`;
                    results.textContent += `File size: ${text.length} bytes\n`;
                    results.textContent += `Contains 'sidebar': ${text.includes('sidebar') ? 'YES' : 'NO'}\n`;
                    results.textContent += `Contains 'custom-sidebar': ${text.includes('custom-sidebar') ? 'YES' : 'NO'}\n`;
                    results.textContent += `\nFirst 500 characters:\n${text.substring(0, 500)}\n`;
                })
                .catch(error => {
                    results.textContent += `\n✗ ERROR: ${error.message}\n`;
                    results.textContent += `This file is not accessible at ${fullUrl}\n`;
                });
        }
    </script>
</body>
</html>